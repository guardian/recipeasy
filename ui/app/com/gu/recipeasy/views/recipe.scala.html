@import com.gu.recipeasy.models._
@(curatedRecipeForm: Form[models.CuratedRecipeForm],
        recipeId: String,
        body: String,
        articleId: String,
        shouldShowButtons: Boolean,
        images: List[ImageDB],
        status: RecipeStatus)(implicit messages: play.api.i18n.Messages, request: RequestHeader)
@import helper.CSRF
@implicitFC = @{ b4.vertical.fieldConstructor }
@link = @{ "https://www.theguardian.com/" + articleId }
@pageTopMessage(status: RecipeStatus) = @{
    status match {
        case New        => "Creation | Pass 1/3"
        case Pending    => "Creation | Pass 1/3"
        case Curated    => "Verification | Pass 2/3"
        case Verified   => "Final Check | Pass 3/3"
        case Finalised  => "Final Check | Pass 3/3"
        case _ => ""
    }
}
@showSkipThisRecipeButton(status: RecipeStatus) = @{
    status match {
        case New     => true
        case Pending => true
        case _       => false
    }
}
@topBannerStatusClass(status: RecipeStatus) = @{
    status match {
        case New        => "top-banner-phase-creation"
        case Pending    => "top-banner-phase-creation"
        case Curated    => "top-banner-phase-verification"
        case Verified   => "top-banner-phase-final"
        case Finalised  => "top-banner-phase-final"
        case _ => ""
    }
}

@layout("Recipeasy"){
<div class="navbar navbar-fixed-top" style="padding:0;">
    <div class="page-top-banner">
        <div>
            <img style="height:55px;" src="@routes.Assets.versioned("images/top-banner-knife-and-fork.png")" alt="icon" />
        </div>
        <div class="top-banner-phase @topBannerStatusClass(status)" style="margin-right:10px;">
            @pageTopMessage(status)
        </div>
        @if(showSkipThisRecipeButton(status)){
            <div style="padding-top:15px;margin-right:10px;">
                <a href="@routes.Application.curateOneRecipeInNewStatus" class="btn btn-warning pull-right recipe__original__skip-button">Skip this recipe</a>
            </div>
        }
        @if(status==Curated){
            <div style="margin-right:10px;font-weight:200;">
                You are verifying the quality of the original curation
            </div>
        }
        @if(status==Verified){
            <div style="margin-right:10px;font-weight:200;">
                Final opportunity for corrections. Could you cook this?
            </div>
        }
        <div style="padding-top:15px;margin-right:10px;">
            <a href="@link" target="_blank" class="btn btn-primary pull-right recipe__original__skip-button">View original article</a>
        </div>
    </div>
</div>
<div class="recipe container-fluid">
    <div class="row">
        <div class="recipe__original col-md-5">

            <h2>Please fill in the form with this recipe</h2>
            <hr>
            <h4>@curatedRecipeForm("title").value</h4>
            @Html(body)
            <hr>
            <h2>Images</h2>
            @for(image <- images){
                <figure data-media-id="@image.mediaId" class="suggested-image">
                    <span class="suggested-image__add">Add to recipe</span>
                    <img src="@image.assetUrl">
                    <figcaption>@image.altText</figcaption>
                </figure>
            }
        </div>
        <div class="recipe__form col-md-7 offset-md-5">
        @b4.form(routes.Application.postCuratedRecipe(recipeId)) {
                    @CSRF.formField
                    <h2>Basic information</h2>
                    @b4.text( curatedRecipeForm("title"), '_label -> "Recipe title", 'class -> "form-control-sm")
                    @b4.text( curatedRecipeForm("credit"), '_label -> "Chef/Cook", 'class -> "form-control-sm typeahead")
                    <div class="flex field__times">
                        <div>
                            <label class="">Preparation time</label>
                            <div class="flex">
                                @b4.number( curatedRecipeForm("times")("preparationHours"), '_label -> "hours", 'placeholder -> "00", 'min -> 0, 'class -> "form-control-sm width-80")
                                @b4.number( curatedRecipeForm("times")("preparationMinutes"), '_label -> "minutes", 'placeholder -> "00", 'min -> 0, 'class -> "form-control-sm width-80")
                            </div>
                        </div>
                        <div>
                            <label class="">Cooking time</label>
                            <div class="flex">
                                @b4.number( curatedRecipeForm("times")("cookingHours"), '_label -> "hours", 'placeholder -> "00", 'min -> 0, 'class -> "form-control-sm width-80")
                                @b4.number( curatedRecipeForm("times")("cookingMinutes"), '_label -> "minutes", 'placeholder -> "00", 'min -> 0, 'class -> "form-control-sm width-80")
                            </div>
                        </div>
                    </div>
                    <h2>Servings</h2>
                    <label><input type="checkbox" id="field__serves-checkbox"> No serving information</label><br>
                    <div class="field__serves flex">
                        @b4.radio( curatedRecipeForm("serves")("portionType"),  options = Seq("ServesType" -> "Serves", "MakesType" -> "Makes"), '_inline -> true, 'label -> "Portion")
                        <div class="flex field__serves__quantity">
                            @b4.number( curatedRecipeForm("serves")("quantity")("from"), 'class -> "form-control-sm")
                            <label class="field__serves__quantity__label">to</label>
                            @b4.number( curatedRecipeForm("serves")("quantity")("to"), 'class -> "form-control-sm")
                        </div>
                    </div>
                    <hr>
                    <h2>Ingredients lists</h2>
                <p>Select text and press <kbd>i</kbd> to add a single ingredient and <kbd>l</kbd> to add multiple lines to a new list.</p>
                    @helpers.multiIngredientsList(curatedRecipeForm("ingredientsLists"), curatedRecipeForm)()
                    <div class="flex centre-children">
                        @b4.button('class -> "btn btn-info center-block ingredients-list__button-add") { <i class="fa fa-plus" aria-hidden="true"></i> Add another ingredient list }
                    </div>
                        <hr />
                    <h2>Method
                        <small class="text-muted">(Remove '1', '2', '3' etc from text)</small>
                    </h2>
                     <p>Select text and press <kbd>m</kbd> to add as a method step</p>

                    @helpers.multiStep( curatedRecipeForm("steps"), curatedRecipeForm)()
                    <hr>
                    <h2>Images
                        <small class="text-muted">Select an image of the dish from the left-hand column</small>
                    </h2>
                    @helpers.multiImage(curatedRecipeForm("images"), curatedRecipeForm)()
                    <hr>
                    <h2>Additional information</h2>
                    <div class="flex wrap-children">
                        @helpers.multiTag(curatedRecipeForm("tags")("cuisine"), curatedRecipeForm)(Tag.cuisines, "cuisine", '_label -> "Cuisines")
                        @helpers.multiTag(curatedRecipeForm("tags")("category"), curatedRecipeForm)(Tag.category, "category", '_label -> "Category")
                        @helpers.multiTag(curatedRecipeForm("tags")("holiday"), curatedRecipeForm)(Tag.holidays, "holiday", '_label -> "Holidays")
                        @helpers.multiTag(curatedRecipeForm("tags")("dietary"), curatedRecipeForm)(Tag.dietary, "dietary", '_label -> "Dietary")
                    </div>
                    <hr>
                    <div class="flex centre-children">
                        @if(shouldShowButtons: Boolean) {
                            @b4.submit('class -> "btn btn-primary center-block") { Submit Recipe }
                        }
                    </div>
        }
        </div>
    </div>

    <div class="container">
        <nav class="navbar navbar-fixed-bottom navbar-light bg-warning">
        Select text and then press:
        <kbd>i</kbd> add a single <strong>i</strong>ngredient to list
        <kbd>l</kbd> add as <strong>l</strong>ist of ingredients
        <kbd>m</kbd> add as <strong>m</strong>ethod step
        </nav>
    </div>

    <script src="@routes.Assets.versioned("javascript/jquery.selection.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascript/mousetrap.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascript/typeahead.jquery.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascript/jquery.unevent.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascript/credits.json")" type="application/json"></script>
    <script src="@routes.Assets.versioned("javascript/editForm.js")" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.11.2/js/bootstrap-select.min.js"></script>

}

